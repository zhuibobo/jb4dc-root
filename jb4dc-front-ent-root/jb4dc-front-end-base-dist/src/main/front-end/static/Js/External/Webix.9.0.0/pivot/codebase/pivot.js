/*
@license
Webix <%= pkg.productName %> v.<%= pkg.version %>
This software is covered by Webix Trial License.
Usage without proper license is prohibited.
(c) XB Software Ltd.
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).pivot={})}(this,(function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,r)};function r(t,r){function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}var i=function(){return(i=Object.assign||function(t){for(var e,r=1,i=arguments.length;r<i;r++)for(var n in e=arguments[r])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};function n(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var i=Array(t),n=0;for(e=0;e<r;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,n++)i[n]=o[a];return i}var o=function(){},a=function(){function t(t,e){this.webixJet=!0,this.webix=t,this._events=[],this._subs={},this._data={},e&&e.params&&t.extend(this._data,e.params)}return t.prototype.getRoot=function(){return this._root},t.prototype.destructor=function(){this._detachEvents(),this._destroySubs(),this._events=this._container=this.app=this._parent=this._root=null},t.prototype.setParam=function(t,e,r){if(this._data[t]!==e&&(this._data[t]=e,this._segment.update(t,e,0),r))return this.show(null)},t.prototype.getParam=function(t,e){var r=this._data[t];if(void 0!==r||!e)return r;var i=this.getParentView();return i?i.getParam(t,e):void 0},t.prototype.getUrl=function(){return this._segment.suburl()},t.prototype.getUrlString=function(){return this._segment.toString()},t.prototype.getParentView=function(){return this._parent},t.prototype.$$=function(t){if("string"==typeof t){var e=this.getRoot();return e.queryView((function(r){return(r.config.id===t||r.config.localId===t)&&r.$scope===e.$scope}),"self")}return t},t.prototype.on=function(t,e,r){var i=t.attachEvent(e,r);return this._events.push({obj:t,id:i}),i},t.prototype.contains=function(t){for(var e in this._subs){var r=this._subs[e].view;if(r===t||r.contains(t))return!0}return!1},t.prototype.getSubView=function(t){var e=this.getSubViewInfo(t);if(e)return e.subview.view},t.prototype.getSubViewInfo=function(t){var e=this._subs[t||"default"];return e?{subview:e,parent:this}:"_top"===t?(this._subs[t]={url:"",id:null,popup:!0},this.getSubViewInfo(t)):this._parent?this._parent.getSubViewInfo(t):null},t.prototype._detachEvents=function(){for(var t=this._events,e=t.length-1;e>=0;e--)t[e].obj.detachEvent(t[e].id)},t.prototype._destroySubs=function(){for(var t in this._subs){var e=this._subs[t].view;e&&e.destructor()}this._subs={}},t.prototype._init_url_data=function(){var t=this._segment.current();this._data={},this.webix.extend(this._data,t.params,!0)},t.prototype._getDefaultSub=function(){if(this._subs.default)return this._subs.default;for(var t in this._subs){var e=this._subs[t];if(!e.branch&&e.view&&"_top"!==t){var r=e.view._getDefaultSub();if(r)return r}}},t.prototype._routed_view=function(){var t=this.getParentView();if(!t)return!0;var e=t._getDefaultSub();return!(!e&&e!==this)&&t._routed_view()},t}();function s(t){"/"===t[0]&&(t=t.substr(1));for(var e=t.split("/"),r=[],i=0;i<e.length;i++){var n=e[i],o={},a=n.indexOf(":");if(-1===a&&(a=n.indexOf("?")),-1!==a)for(var s=0,u=n.substr(a+1).split(/[\:\?\&]/g);s<u.length;s++){var l=u[s].split("=");o[l[0]]=decodeURIComponent(l[1])}r[i]={page:a>-1?n.substr(0,a):n,params:o,isNew:!0}}return r}function u(t){for(var e=[],r=0,i=t;r<i.length;r++){var n=i[r];e.push("/"+n.page);var o=l(n.params);o&&e.push("?"+o)}return e.join("")}function l(t){var e=[];for(var r in t)"object"!=typeof t[r]&&(e.length&&e.push("&"),e.push(r+"="+encodeURIComponent(t[r])));return e.join("")}var c=function(){function t(t,e){this._next=1,this.route="string"==typeof t?{url:s(t),path:t}:t,this.index=e}return t.prototype.current=function(){return this.route.url[this.index]},t.prototype.next=function(){return this.route.url[this.index+this._next]},t.prototype.suburl=function(){return this.route.url.slice(this.index)},t.prototype.shift=function(e){var r=new t(this.route,this.index+this._next);return r.setParams(r.route.url,e,r.index),r},t.prototype.setParams=function(t,e,r){if(e){var i=t[r].params;for(var n in e)i[n]=e[n]}},t.prototype.refresh=function(){for(var t=this.route.url,e=this.index+1;e<t.length;e++)t[e].isNew=!0},t.prototype.toString=function(){var t=u(this.suburl());return t?t.substr(1):""},t.prototype._join=function(t,e){var r=this.route.url;if(null===t)return r;var i=this.route.url,n=!0;if(r=i.slice(0,this.index+(e?this._next:0)),t){r=r.concat(s(t));for(var o=0;o<r.length;o++)i[o]&&(r[o].view=i[o].view),n&&i[o]&&r[o].page===i[o].page?r[o].isNew=!1:r[o].isNew&&(n=!1)}return r},t.prototype.append=function(t){var e=this._join(t,!0);return this.route.path=u(e),this.route.url=e,this.route.path},t.prototype.show=function(t,e,r){var i=this,n=this._join(t.url,r);return this.setParams(n,t.params,this.index+(r?this._next:0)),new Promise((function(t,r){var a=u(n),s={url:n,redirect:a,confirm:Promise.resolve()},l=e?e.app:null;if(l&&!l.callEvent("app:guard",[s.redirect,e,s]))return void r(new o);s.confirm.catch((function(t){return r(t)})).then((function(){if(null!==s.redirect){if(s.redirect!==a)return l.show(s.redirect),void r(new o);i.route.path=a,i.route.url=n,t()}else r(new o)}))}))},t.prototype.size=function(t){this._next=t},t.prototype.split=function(){var e={url:this.route.url.slice(this.index+1),path:""};return e.url.length&&(e.path=u(e.url)),new t(e,0)},t.prototype.update=function(t,e,r){var i=this.route.url[this.index+(r||0)];if(!i)return this.route.url.push({page:"",params:{}}),this.update(t,e,r);""===t?i.page=e:i.params[t]=e,this.route.path=u(this.route.url)},t}(),p=function(t){function e(e,r){var i=t.call(this,e.webix)||this;return i.app=e,i._children=[],i}return r(e,t),e.prototype.ui=function(t,e){var r=(e=e||{}).container||t.container,i=this.app.createView(t);return this._children.push(i),i.render(r,this._segment,this),"object"!=typeof t||t instanceof a?i:i.getRoot()},e.prototype.show=function(t,e){if(e=e||{},"object"==typeof t){for(var r in t)this.setParam(r,t[r]);t=null}else{if("/"===t.substr(0,1))return this.app.show(t,e);if(0===t.indexOf("./")&&(t=t.substr(2)),0===t.indexOf("../")){var i=this.getParentView();return i?i.show(t.substr(3),e):this.app.show("/"+t.substr(3))}var n=this.getSubViewInfo(e.target);if(n){if(n.parent!==this)return n.parent.show(t,e);if(e.target&&"default"!==e.target)return this._renderFrameLock(e.target,n.subview,{url:t,params:e.params})}else if(t)return this.app.show("/"+t,e)}return this._show(this._segment,{url:t,params:e.params},this)},e.prototype._show=function(t,e,r){var i=this;return t.show(e,r,!0).then((function(){return i._init_url_data(),i._urlChange()})).then((function(){t.route.linkRouter&&(i.app.getRouter().set(t.route.path,{silent:!0}),i.app.callEvent("app:route",[t.route.path]))}))},e.prototype.init=function(t,e){},e.prototype.ready=function(t,e){},e.prototype.config=function(){this.app.webix.message("View:Config is not implemented")},e.prototype.urlChange=function(t,e){},e.prototype.destroy=function(){},e.prototype.destructor=function(){this.destroy(),this._destroyKids(),this._root&&(this._root.destructor(),t.prototype.destructor.call(this))},e.prototype.use=function(t,e){t(this.app,this,e)},e.prototype.refresh=function(){this.getUrl();return this.destroy(),this._destroyKids(),this._destroySubs(),this._detachEvents(),this._container.tagName&&this._root.destructor(),this._segment.refresh(),this._render(this._segment)},e.prototype.render=function(t,e,r){var i=this;"string"==typeof e&&(e=new c(e,0)),this._segment=e,this._parent=r,this._init_url_data();var n="string"==typeof(t=t||document.body)?this.webix.toNode(t):t;return this._container!==n?(this._container=n,this._render(e)):this._urlChange().then((function(){return i.getRoot()}))},e.prototype._render=function(t){var e=this,r=this.config();return r.then?r.then((function(r){return e._render_final(r,t)})):this._render_final(r,t)},e.prototype._render_final=function(t,e){var r,i=this,n=null,o=null,a=!1;if(this._container.tagName?o=this._container:(n=this._container).popup?(o=document.body,a=!0):o=this.webix.$$(n.id),!this.app||!o)return Promise.reject(null);var s=this._segment.current(),u={ui:{}};this.app.copyConfig(t,u.ui,this._subs),this.app.callEvent("app:render",[this,e,u]),u.ui.$scope=this,!n&&s.isNew&&s.view&&s.view.destructor();try{if(n&&!a){var l=o,c=l.getParentView();c&&"multiview"===c.name&&!u.ui.id&&(u.ui.id=l.config.id)}this._root=this.app.webix.ui(u.ui,o);var p=this._root;a&&p.setPosition&&!p.isVisible()&&p.show(),n&&(n.view&&n.view!==this&&n.view!==this.app&&n.view.destructor(),n.id=this._root.config.id,this.getParentView()||!this.app.app?n.view=this:n.view=this.app),s.isNew&&(s.view=this,s.isNew=!1),r=Promise.resolve(this._init(this._root,e)).then((function(){return i._urlChange().then((function(){return i._initUrl=null,i.ready(i._root,e.suburl())}))}))}catch(t){r=Promise.reject(t)}return r.catch((function(t){return i._initError(i,t)}))},e.prototype._init=function(t,e){return this.init(t,e.suburl())},e.prototype._urlChange=function(){var t=this;this.app.callEvent("app:urlchange",[this,this._segment]);var e=[];for(var r in this._subs){var i=this._subs[r],n=this._renderFrameLock(r,i,null);n&&e.push(n)}return Promise.all(e).then((function(){return t.urlChange(t._root,t._segment.suburl())}))},e.prototype._renderFrameLock=function(t,e,r){if(!e.lock){var i=this._renderFrame(t,e,r);i&&(e.lock=i.then((function(){return e.lock=null}),(function(){return e.lock=null})))}return e.lock},e.prototype._renderFrame=function(t,e,r){var i=this;if("default"===t){if(this._segment.next()){var n=r?r.params:null;return e.params&&(n=this.webix.extend(n||{},e.params)),this._createSubView(e,this._segment.shift(n))}e.view&&e.popup&&(e.view.destructor(),e.view=null)}if(null!==r&&(e.url=r.url,e.params&&(r.params=this.webix.extend(r.params||{},e.params))),e.route){if(null!==r)return e.route.show(r,e.view).then((function(){return i._createSubView(e,e.route)}));if(e.branch)return}var o=e.view;if(!o&&e.url){if("string"==typeof e.url)return e.route=new c(e.url,0),r&&e.route.setParams(e.route.route.url,r.params,0),e.params&&e.route.setParams(e.route.route.url,e.params,0),this._createSubView(e,e.route);"function"!=typeof e.url||o instanceof e.url||(o=new(this.app._override(e.url))(this.app,"")),o||(o=e.url)}if(o)return o.render(e,e.route||this._segment,this)},e.prototype._initError=function(t,e){return this.app&&this.app.error("app:error:initview",[e,t]),!0},e.prototype._createSubView=function(t,e){var r=this;return this.app.createFromURL(e.current()).then((function(i){return i.render(t,e,r)}))},e.prototype._destroyKids=function(){for(var t=this._children,e=t.length-1;e>=0;e--)t[e]&&t[e].destructor&&t[e].destructor();this._children=[]},e}(a),h=function(t){function e(e,r){var i=t.call(this,e,r)||this;return i._ui=r.ui,i}return r(e,t),e.prototype.config=function(){return this._ui},e}(p),f=function(){function t(t,e,r){this.path="",this.app=r}return t.prototype.set=function(t,e){this.path=t;var r=this.app;r.app.getRouter().set(r._segment.append(this.path),{silent:!0})},t.prototype.get=function(){return this.path},t}(),d=!0,g=function(t){function e(e){var r=this,i=(e||{}).webix||window.webix;return e=i.extend({name:"App",version:"1.0",start:"/home"},e,!0),(r=t.call(this,i,e)||this).config=e,r.app=r.config.app,r.ready=Promise.resolve(),r._services={},r.webix.extend(r,r.webix.EventSystem),r}return r(e,t),e.prototype.getUrl=function(){return this._subSegment.suburl()},e.prototype.getUrlString=function(){return this._subSegment.toString()},e.prototype.getService=function(t){var e=this._services[t];return"function"==typeof e&&(e=this._services[t]=e(this)),e},e.prototype.setService=function(t,e){this._services[t]=e},e.prototype.destructor=function(){this.getSubView().destructor(),t.prototype.destructor.call(this)},e.prototype.copyConfig=function(t,e,r){if((t instanceof a||"function"==typeof t&&t.prototype instanceof a)&&(t={$subview:t}),void 0!==t.$subview)return this.addSubView(t,e,r);var i=t instanceof Array;for(var n in e=e||(i?[]:{}),t){var o=t[n];if("function"==typeof o&&o.prototype instanceof a&&(o={$subview:o}),!o||"object"!=typeof o||o instanceof this.webix.DataCollection||o instanceof RegExp||o instanceof Map)e[n]=o;else if(o instanceof Date)e[n]=new Date(o);else{var s=this.copyConfig(o,o instanceof Array?[]:{},r);null!==s&&(i?e.push(s):e[n]=s)}}return e},e.prototype.getRouter=function(){return this.$router},e.prototype.clickHandler=function(t,e){if(t&&(e=e||t.target||t.srcElement)&&e.getAttribute){var r=e.getAttribute("trigger");if(r)return this._forView(e,(function(t){return t.app.trigger(r)})),t.cancelBubble=!0,t.preventDefault();var i=e.getAttribute("route");if(i)return this._forView(e,(function(t){return t.show(i)})),t.cancelBubble=!0,t.preventDefault()}var n=e.parentNode;n&&this.clickHandler(t,n)},e.prototype.getRoot=function(){return this.getSubView().getRoot()},e.prototype.refresh=function(){var t=this;return this._subSegment?this.getSubView().refresh().then((function(e){return t.callEvent("app:route",[t.getUrl()]),e})):Promise.resolve(null)},e.prototype.loadView=function(t){var e=this,r=this.config.views,i=null;if(""===t)return Promise.resolve(this._loadError("",new Error("Webix Jet: Empty url segment")));try{r&&"string"==typeof(i="function"==typeof r?r(t):r[t])&&(t=i,i=null),i||("_hidden"===t?i={hidden:!0}:"_blank"===t?i={}:(t=t.replace(/\./g,"/"),i=this.require("jet-views",t)))}catch(e){i=this._loadError(t,e)}return i.then||(i=Promise.resolve(i)),i=i.then((function(t){return t.__esModule?t.default:t})).catch((function(r){return e._loadError(t,r)}))},e.prototype._forView=function(t,e){var r=this.webix.$$(t);r&&e(r.$scope)},e.prototype._loadViewDynamic=function(t){return null},e.prototype.createFromURL=function(t){var e=this;return t.isNew||!t.view?this.loadView(t.page).then((function(r){return e.createView(r,name,t.params)})):Promise.resolve(t.view)},e.prototype._override=function(t){var e=this.config.override;if(e){for(var r=void 0;t;)r=t,t=e.get(t);return r}return t},e.prototype.createView=function(t,r,i){if("function"==typeof(t=this._override(t))){if(t.prototype instanceof e)return new t({app:this,name:r,params:i,router:f});if(t.prototype instanceof a)return new t(this,{name:r,params:i});t=t(this)}return t instanceof a?t:new h(this,{name:r,ui:t})},e.prototype.show=function(t,e){return t&&this.app&&0==t.indexOf("//")?this.app.show(t.substr(1),e):this.render(this._container,t||this.config.start,e)},e.prototype.trigger=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];this.apply(t,e)},e.prototype.apply=function(t,e){this.callEvent(t,e)},e.prototype.action=function(t){return this.webix.bind((function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];this.apply(t,e)}),this)},e.prototype.on=function(t,e){this.attachEvent(t,e)},e.prototype.use=function(t,e){t(this,null,e)},e.prototype.error=function(t,e){if(this.callEvent(t,e),this.callEvent("app:error",e),this.config.debug)for(var r=0;r<e.length;r++)if(console.error(e[r]),e[r]instanceof Error){var i=e[r].message;0===i.indexOf("Module build failed")?(i=i.replace(/\x1b\[[0-9;]*m/g,""),document.body.innerHTML="<pre style='font-size:16px; background-color: #ec6873; color: #000; padding:10px;'>"+i+"</pre>"):(i+="<br><br>Check console for more details",this.webix.message({type:"error",text:i,expire:-1}))}},e.prototype.render=function(t,e,r){var i=this;this._container="string"==typeof t?this.webix.toNode(t):t||document.body;var n=null;!this.$router?(d&&"tagName"in this._container&&(this.webix.event(document.body,"click",(function(t){return i.clickHandler(t)})),d=!1),"string"==typeof e&&(e=new c(e,0)),this._subSegment=this._first_start(e),this._subSegment.route.linkRouter=!0):n="string"==typeof e?e:this.app?e.split().route.path||this.config.start:e.toString();var o=r?r.params:this.config.params||null,a=this.getSubView(),s=this._subSegment,u=s.show({url:n,params:o},a).then((function(){return i.createFromURL(s.current())})).then((function(e){return e.render(t,s)})).then((function(t){return i.$router.set(s.route.path,{silent:!0}),i.callEvent("app:route",[i.getUrl()]),t}));return this.ready=this.ready.then((function(){return u})),u},e.prototype.getSubView=function(){if(this._subSegment){var t=this._subSegment.current().view;if(t)return t}return new p(this,{})},e.prototype.require=function(t,e){return null},e.prototype._first_start=function(t){var e=this;this._segment=t;if(this.$router=new this.config.router((function(t){return setTimeout((function(){e.show(t).catch((function(t){if(!(t instanceof o))throw t}))}),1)}),this.config,this),this._container===document.body&&!1!==this.config.animation){var r=this._container;this.webix.html.addCss(r,"webixappstart"),setTimeout((function(){e.webix.html.removeCss(r,"webixappstart"),e.webix.html.addCss(r,"webixapp")}),10)}if(t){if(this.app){var i=t.current().view;t.current().view=this,t.next()?(t.refresh(),t=t.split()):t=new c(this.config.start,0),t.current().view=i}}else{var n=this.$router.get();n||(n=this.config.start,this.$router.set(n,{silent:!0})),t=new c(n,0)}return t},e.prototype._loadError=function(t,e){return this.error("app:error:resolve",[e,t]),{template:" "}},e.prototype.addSubView=function(t,e,r){var i=!0!==t.$subview?t.$subview:null,n=t.name||(i?this.webix.uid():"default");return e.id=t.id||"s"+this.webix.uid(),(r[n]={id:e.id,url:i,branch:t.branch,popup:t.popup,params:t.params}).popup?null:e},e}(a),v=function(){function t(t,e){var r=this;this.config=e||{},this._detectPrefix(),this.cb=t,window.onpopstate=function(){return r.cb(r.get())}}return t.prototype.set=function(t,e){var r=this;if(this.config.routes){var i=t.split("?",2);for(var n in this.config.routes)if(this.config.routes[n]===i[0]){t=n+(i.length>1?"?"+i[1]:"");break}}this.get()!==t&&window.history.pushState(null,null,this.prefix+this.sufix+t),e&&e.silent||setTimeout((function(){return r.cb(t)}),1)},t.prototype.get=function(){var t=this._getRaw().replace(this.prefix,"").replace(this.sufix,"");if(t="/"!==t&&"#"!==t?t:"",this.config.routes){var e=t.split("?",2),r=this.config.routes[e[0]];r&&(t=r+(e.length>1?"?"+e[1]:""))}return t},t.prototype._detectPrefix=function(){var t=this.config.routerPrefix;this.sufix="#"+(void 0===t?"!":t),this.prefix=document.location.href.split("#",2)[0]},t.prototype._getRaw=function(){return document.location.href},t}(),m=!1;function _(t){if(!m&&t){m=!0;var e=window;e.Promise||(e.Promise=t.promise);var r=t.version.split(".");10*r[0]+1*r[1]<53&&(t.ui.freeze=function(e){var r=e();return r&&r.then?r.then((function(e){return t.ui.$freeze=!1,t.ui.resize(),e})):(t.ui.$freeze=!1,t.ui.resize()),r});var i=t.ui.baselayout.prototype.addView,n=t.ui.baselayout.prototype.removeView,o={addView:function(t,e){if(this.$scope&&this.$scope.webixJet&&!t.queryView){var r=this.$scope,n={};t=r.app.copyConfig(t,{},n),i.apply(this,[t,e]);var o=function(t){r._renderFrame(t,n[t],null).then((function(){r._subs[t]=n[t]}))};for(var a in n)o(a);return t.id}return i.apply(this,arguments)},removeView:function(){if(n.apply(this,arguments),this.$scope&&this.$scope.webixJet){var e=this.$scope._subs;for(var r in e){var i=e[r];t.$$(i.id)||(i.view.destructor(),delete e[r])}}}};t.extend(t.ui.layout.prototype,o,!0),t.extend(t.ui.baselayout.prototype,o,!0),t.protoUI({name:"jetapp",$init:function(e){this.$app=new this.app(e);var r=t.uid().toString();e.body={id:r},this.$ready.push((function(){this.callEvent("onInit",[this.$app]),this.$app.render({id:r})}))}},t.ui.proxy,t.EventSystem)}}var w=function(t){function e(e){var r;return e.router=e.router||v,_((r=t.call(this,e)||this).webix),r}return r(e,t),e.prototype.require=function(t,e){return require(t+"/"+e)},e}(g),y=(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}r(e,t),e.prototype._detectPrefix=function(){this.prefix="",this.sufix=this.config.routerPrefix||""},e.prototype._getRaw=function(){return document.location.pathname+(document.location.search||"")}}(v),function(){function t(t,e){this.path="",this.cb=t}return t.prototype.set=function(t,e){var r=this;this.path=t,e&&e.silent||setTimeout((function(){return r.cb(t)}),1)},t.prototype.get=function(){return this.path},t}());function b(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function x(t,e,r){for(var i in t)b(t,i)&&e.call(r||t,t[i],i,t)}function S(t){t="Warning: "+t,"undefined"!=typeof console&&console.error(t);try{throw new Error(t)}catch(t){}}var C=String.prototype.replace,$=String.prototype.split,V=function(t){var e=t%10;return 11!==t&&1===e?0:2<=e&&e<=4&&!(t>=12&&t<=14)?1:2},k={arabic:function(t){if(t<3)return t;var e=t%100;return e>=3&&e<=10?3:e>=11?4:5},bosnian_serbian:V,chinese:function(){return 0},croatian:V,french:function(t){return t>1?1:0},german:function(t){return 1!==t?1:0},russian:V,lithuanian:function(t){return t%10==1&&t%100!=11?0:t%10>=2&&t%10<=9&&(t%100<11||t%100>19)?1:2},czech:function(t){return 1===t?0:t>=2&&t<=4?1:2},polish:function(t){if(1===t)return 0;var e=t%10;return 2<=e&&e<=4&&(t%100<10||t%100>=20)?1:2},icelandic:function(t){return t%10!=1||t%100==11?1:0},slovenian:function(t){var e=t%100;return 1===e?0:2===e?1:3===e||4===e?2:3}},P={arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]};function R(t){var e,r=(e={},x(P,(function(t,r){x(t,(function(t){e[t]=r}))})),e);return r[t]||r[$.call(t,/-/,1)[0]]||r.en}function O(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var L=/\$/g,A=/%\{(.*?)\}/g;function F(t,e,r,i){if("string"!=typeof t)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==e)return t;var n=t,o=i||A,a="number"==typeof e?{smart_count:e}:e;if(null!=a.smart_count&&n){var s=$.call(n,"||||");n=(s[function(t,e){return k[R(t)](e)}(r||"en",a.smart_count)]||s[0]).replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}return n=C.call(n,o,(function(t,e){return b(a,e)&&null!=a[e]?C.call(a[e],L,"$$"):t}))}function E(t){var e=t||{};this.phrases={},this.extend(e.phrases||{}),this.currentLocale=e.locale||"en";var r=e.allowMissing?F:null;this.onMissingKey="function"==typeof e.onMissingKey?e.onMissingKey:r,this.warn=e.warn||S,this.tokenRegex=function(t){var e=t&&t.prefix||"%{",r=t&&t.suffix||"}";if("||||"===e||"||||"===r)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(O(e)+"(.*?)"+O(r),"g")}(e.interpolation)}E.prototype.locale=function(t){return t&&(this.currentLocale=t),this.currentLocale},E.prototype.extend=function(t,e){x(t,(function(t,r){var i=e?e+"."+r:r;"object"==typeof t?this.extend(t,i):this.phrases[i]=t}),this)},E.prototype.unset=function(t,e){"string"==typeof t?delete this.phrases[t]:x(t,(function(t,r){var i=e?e+"."+r:r;"object"==typeof t?this.unset(t,i):delete this.phrases[i]}),this)},E.prototype.clear=function(){this.phrases={}},E.prototype.replace=function(t){this.clear(),this.extend(t)},E.prototype.t=function(t,e){var r,i,n=null==e?{}:e;if("string"==typeof this.phrases[t])r=this.phrases[t];else if("string"==typeof n._)r=n._;else if(this.onMissingKey){i=(0,this.onMissingKey)(t,n,this.currentLocale,this.tokenRegex)}else this.warn('Missing translation for key: "'+t+'"'),i=t;return"string"==typeof r&&(i=F(r,n,this.currentLocale,this.tokenRegex)),i},E.prototype.has=function(t){return b(this.phrases,t)},E.transformPhrase=function(t,e,r){return F(t,e,r)};var j=E;var T=window.webix;T&&_(T);var I=function(t,e,r){var i=(r=r||{}).storage,n=i?i.get("lang")||"en":r.lang||"en";function o(e,o,a){o.__esModule&&(o=o.default);var u={phrases:o};r.polyglot&&t.webix.extend(u,r.polyglot);var l=s.polyglot=new j(u);if(l.locale(e),s._=t.webix.bind(l.t,l),n=e,i&&i.put("lang",n),r.webix){var c=r.webix[e];c&&t.webix.i18n.setLocale(c)}return a?Promise.resolve():t.refresh()}function a(e,i){if(!1!==r.path){var n=(r.path?r.path+"/":"")+e;o(e,t.require("jet-locales",n),i)}}var s={getLang:function(){return n},setLang:a,setLangData:o,_:null,polyglot:null};t.setService("locale",s),a(n,!0)},M=window;M.Promise||(M.Promise=M.webix.promise);var D=1;function H(t,e,r){Object.defineProperty(e,r,{get:function(){return t[r]},set:function(e){return t[r]=e}})}function U(t,e){e=e||{};var r={},i={},n=function(t,e){var n=D++;return r[n]={mask:t,handler:e},e("*"===t?i:i[t],void 0,t),n},o=[],a=!1,s=function(t,e,i,n){if(a)o.push([t,e,i,n]);else for(var s=Object.keys(r),u=0;u<s.length;u++){var l=r[s[u]];l&&("*"!==l.mask&&l.mask!==t||l.handler(i,e,t,n))}};return Object.defineProperty(i,"$changes",{value:{attachEvent:n,detachEvent:function(t){delete r[t]}},enumerable:!1,configurable:!1}),Object.defineProperty(i,"$observe",{value:n,enumerable:!1,configurable:!1}),Object.defineProperty(i,"$batch",{value:function(t){if("function"!=typeof t){var e=t;t=function(){for(var t in e)i[t]=e[t]}}for(a=!0,t(i),a=!1;o.length;){var r=o.shift();s.apply(this,r)}},enumerable:!1,configurable:!1}),Object.defineProperty(i,"$extend",{value:function(t,r){for(var n in r=r||e,t)if(t.hasOwnProperty(n)){var o=t[n];r.nested&&"object"==typeof o&&o?i[n]=U(o,r):B(i,o,n,s)}},enumerable:!1,configurable:!1}),i.$extend(t,e),i}function B(t,e,r,i){Object.defineProperty(t,r,{get:function(){return e},set:function(t){if(null===e||null===t?e!==t:e.valueOf()!=t.valueOf()){var n=e;e=t,i(r,n,t,null)}},enumerable:!0,configurable:!1})}var G=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.config=function(){var t=this.State=this.getParam("state",!0),e={view:"chart",$mainView:!0,borderless:!0,localId:"data",xAxis:{},yAxis:{}};webix.extend(e,t.chart,!0),e.xAxis.template||(e.xAxis.template=function(t){return t[t.length-1]});var r={lines:t.chart.lines};return t.chart.scaleColor&&(r.color=r.lineColor=t.chart.scaleColor),webix.extend(e.xAxis,r,!0),webix.extend(e.yAxis,r,!0),e},e.prototype.init=function(){var t=this;this.Local=this.app.getService("local"),this.LoadData(),this.on(this.State.$changes,"structure",(function(e,r){r&&t.UpdateStructure()})),this.on(this.State.$changes,"chart",(function(e,r){r&&t.refresh()}))},e.prototype.LoadData=function(){var t=this;return this.Local.getData().then((function(e){t.UpdateChart(e)}))},e.prototype.UpdateStructure=function(){var t=this.Local.getPivotData();this.UpdateChart(t)},e.prototype.UpdateChart=function(t){this.$$("data").clearAll(),this.$$("data").removeAllSeries(),this.SetSeries(t.values),this.$$("data").parse(t.data)},e.prototype.SetSeries=function(t){for(var e=this,r=this.State.chart.type,i=this.app.getService("locale")._,n=function(n){if(o.$$("data").addSeries({value:function(t){return t[n]},alpha:"area"==r||"splineArea"==r?.7:1,color:t[n].color,tooltip:function(t){return t[n]},item:{color:t[n].color,borderColor:t[n].color},line:{color:t[n].color}}),t[n].text!=t[n].operation){var a=t[n].text.split(",");a=a.map((function(t){return e.Local.getField(t).value})).join(", "),t[n].text=a+" ("+i(t[n].operation)+")"}else t[n].text=o.Local.fixMath(t[n].operation)},o=this,a=0;a<t.length;a++)n(a);this.SetLegend(t)},e.prototype.SetLegend=function(t){var e=webix.extend({values:t,valign:"middle",align:"right",layout:"y"},this.State.chart.legend||{},!0);this.$$("data").define({legend:e})},e}(p);webix.protoUI({name:"pivot-portlet",$reorderOnly:!0,$drag:function(t){webix.html.addCss(this.$view,"portlet_in_drag");var e=webix.DragControl.getContext();e.source=e.from=t,webix.callEvent("onClick",[]);var r=this.$scope.app.getService("local"),i=this.getChildViews()[0].getValues(),n=i.name?r.getField(i.name).value:"";if(i.name2&&(n+=(n?", ":"")+r.getField(i.name2).value),webix.isUndefined(i.name)&&i.operation)n=r.fixMath(i.operation);else if(n)i.operation&&(n+=" ("+i.operation+")");else{n=(0,this.$scope.app.getService("locale")._)("Field not defined")}var o=webix.skin.$active;return'<div class="webix_pivot_portlet_drag" style="'+("width:"+(this.$width-o.inputHeight)+"px;height:"+this.$height+"px;")+'">\n\t\t\t\t<span class="webix_icon '+this.config.icon+'"></span>'+n+"\n\t\t\t</div>"}},webix.ui.portlet);var z=function(t){function e(e,r,i){var n=t.call(this,e,r)||this;return i||(i={}),n.plusLabel=i.plusLabel,n.field=i.field,n}return r(e,t),e.prototype.config=function(){var t=this,e=webix.skin.$active;return{borderless:!0,type:"clean",paddingY:8,rows:[{localId:"forms",type:"clean",rows:[]},{template:'<div class="webix_pivot_handle_add_value">\n\t\t\t\t\t\t<span class="webix_icon wxi-plus-circle"></span><span>'+this.plusLabel+"</span>\n\t\t\t\t\t</div>",css:"webix_pivot_add_value",height:e.inputHeight-2*e.inputPadding,localId:"addValue",onClick:{webix_pivot_handle_add_value:function(){var e=t.$$("forms").getChildViews(),r=t.Add(null,e.length),i=webix.$$(r).queryView({name:"name"});i&&(i.focus(),webix.html.triggerEvent(i.getInputNode(),"MouseEvents","click")),"values"!=t.field&&e.length==t.app.getState().fields.length&&t.$$("addValue").hide()}}}]}},e.prototype.init=function(){var t=this;this.on(webix,"onAfterPortletMove",(function(e){e==t.$$("forms")&&t.app.callEvent("property:change",[t.field,t.GetValue()])})),this.on(webix,"onPortletDrag",(function(t,e){if(t.$reorderOnly)return t.getParentView()===e.getParentView()}))},e.prototype.ListTemplate=function(t){var e=this._activeInput,r="values"==this.field&&e&&!e.$destructed&&"wavg"==e.getFormView().elements.operation.getValue(),i=this.getParentView().GetCorrections()[this.field],n=t.value;if(!r&&i){var o="webix_pivot_list_marker";return this.CheckCorrections(i,t.id)&&(o+=" webix_pivot_list_marker_fill"),'<div class="'+o+'"> '+n+"</div>"}return n},e.prototype.CheckCorrections=function(t,e){if(this._activeInput&&e==this._activeInput.getValue())return!0;for(var r=this.app.getStructure(),i=0;i<t.length;i++){var n=r[t[i]];if(n)if("string"==typeof n){if(n==e)return!0}else for(var o=0;o<n.length;o++){var a=n[o];if(a.name&&(a=a.name),a==e)return!0}}return!1},e.prototype.GetValue=function(){var t=this.$$("forms").getChildViews(),e=[];return t.forEach((function(t){var r=t.getChildViews()[0].getValues().name;r&&e.push(r)})),e},e.prototype.SetValue=function(t){for(var e=this.$$("forms"),r=e.getChildViews(),i=r.length-1;i>=0;i--)e.removeView(r[i]);for(i=0;i<t.length;i++)t[i].external||this.Add(t[i],i)},e.prototype.Add=function(t,e){var r=this;return this.$$("forms").addView({view:"pivot-portlet",mode:"replace",borderless:!0,body:{view:"form",paddingY:0,paddingX:2,elements:[{margin:2,cols:this.ItemConfig(t,e)}],on:{onChange:function(){r.app.callEvent("property:change",[r.field,r.GetValue()])}}}})},e.prototype.ItemConfig=function(t){var e=this;return[{width:webix.skin.$active.inputHeight},{view:"richselect",name:"name",value:this.PrepareValue(t),options:{css:"webix_pivot_suggest",data:this.app.getState().fields,on:{onBeforeShow:function(){var t=webix.$$(this.config.master),e=t.$scope,r=e.GetValue();e._activeInput=t,this.getList().filter((function(i){return e.FilterSuggest(r,t.getValue(),i)}))}},body:{template:function(t){return e.ListTemplate(t)}}}},{view:"icon",icon:"wxi-close",css:"webix_pivot_close_icon",click:function(){var t=this.$scope;t.$$("addValue").show(),t.$$("forms").removeView(this.queryView("pivot-portlet","parent")),t.app.callEvent("property:change",[t.field,t.GetValue()])}}]},e.prototype.PrepareValue=function(t){return t?("object"==typeof t&&(t=t.name),webix.isArray(t)&&(t=t[0])):t="",t},e.prototype.FilterSuggest=function(t,e,r){return(r=r.id)==e||!t.find((function(t){return t.name&&(t=t.name),r==t}))},e}(p),N=function(t){function e(e,r,i){var n=t.call(this,e,r,i)||this;n.Local=n.app.getService("local");var o=n.app.getService("locale")._;return n.typeName="operation",n.plusLabel=o("Add value"),n.field="values",n.operations=n.Local.operations,n.operations.map((function(t){return t.value=o(t.id),t})),n}return r(e,t),e.prototype.init=function(){var e=this;t.prototype.init.call(this),this.State=this.app.getState(),this.on(this.State.$changes,"mode",(function(t){e.ToggleColors("chart"==t)}))},e.prototype.GetValue=function(){var t=this.$$("forms").getChildViews(),e=[];return t.forEach((function(t){var r=t.getChildViews()[0].getValues({hidden:!1});webix.isUndefined(r.name2)||(r.name&&r.name2?(r.name=[r.name,r.name2],delete r.name2):r.name=""),""!=r.name&&e.push(r)})),e},e.prototype.ItemConfig=function(e,r){var i=t.prototype.ItemConfig.call(this,e);if(e&&!e.name)i.splice(1,1,{view:"label",css:"webix_pivot_complex_operation",name:"operation",label:this.Local.fixMath(e.operation),value:e.operation});else{var n=void 0;if(e)n=e.operation;else{var o=this.app.config.defaultOperation,a=Math.max(this.operations.findIndex((function(t){return t.id==o})),0);n=this.operations[a].id}i.splice(2,0,{view:"richselect",name:"operation",width:100,value:n,options:{css:"webix_pivot_suggest",data:this.operations},on:{onChange:function(t){this.$scope.SetOperation(t,this)}}}),i.splice(2,0,{view:"richselect",hidden:!e||"wavg"!=e.operation,value:e&&webix.isArray(e.name)?e.name[1]:"",name:"name2",options:{css:"webix_pivot_suggest",data:this.app.getState().fields}})}var s="mini"==webix.skin.$name||"compact"==webix.skin.$name,u=this.Local.getPalette(),l=e&&e.color||this.Local.getValueColor(r);return i.splice(1,0,{view:"colorpicker",hidden:"chart"!=this.State.mode,name:"color",css:"webix_pivot_value_color",value:l,width:s?30:38,suggest:{type:"colorboard",body:{width:150,height:150,view:"colorboard",palette:u}}}),i},e.prototype.ToggleColors=function(t){for(var e=this.$$("forms").getChildViews(),r=0;r<e.length;r++){var i=e[r].getChildViews()[0].elements.color;t?i.show():i.hide()}},e.prototype.FilterSuggest=function(){return!0},e.prototype.SetOperation=function(t,e){var r=e.getFormView();"wavg"==t?r.elements.name2.show():r.elements.name2.hide()},e}(z),W=function(t){function e(e,r){var i=t.call(this,e,r)||this;return i.field="groupBy",i}return r(e,t),e.prototype.config=function(){var t=this;return{padding:10,rows:[{view:"richselect",localId:"group",options:{css:"webix_pivot_suggest",data:this.app.getState().fields,body:{template:function(e){return t.ListTemplate(e)}},on:{onBeforeShow:function(){t._activeInput=t.$$("group")}}},on:{onChange:function(e,r,i){"user"==i&&t.app.callEvent("property:change",[t.field,e])}}}]}},e.prototype.GetValue=function(){return this.$$("group").getValue()},e.prototype.SetValue=function(t){this.$$("group").setValue(t)},e}(z),X=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return{view:"form",complexData:!0,padding:10,elements:[{name:"type",view:"richselect",value:"bar",options:{css:"webix_pivot_suggest",data:[{id:"bar",value:e("Bar")},{id:"line",value:e("Line")},{id:"radar",value:e("Radar")},{id:"area",value:e("Area")},{id:"spline",value:e("Spline")},{id:"splineArea",value:e("Spline Area")}]}},{name:"xAxis.title",view:"text",label:e("X axis title"),batch:"axis"},{name:"yAxis.title",view:"text",label:e("Y axis title"),batch:"axis"},{name:"scaleColor",view:"colorpicker",editable:!0,label:e("Scale color"),suggest:{type:"colorboard",body:{width:150,height:150,view:"colorboard",palette:this.app.getService("local").getPalette()}}},{name:"scale",view:"checkbox",checkValue:"logarithmic",uncheckValue:"linear",labelWidth:0,labelRight:e("Logarithmic scale")},{name:"yAxis.lineShape",view:"checkbox",batch:"radar",checkValue:"arc",labelWidth:0,labelRight:e("Circled lines")},{name:"lines",view:"checkbox",labelWidth:0,labelRight:e("Lines")}],on:{onChange:function(e,r,i){"user"==i&&(t.innerChange=!0,t.State.chart=Object.assign({},t.getRoot().getValues()),t.handleVisibility(),delete t.innerChange)}}}},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0),this.on(this.State.$changes,"chart",(function(e){t.innerChange||(t.getRoot().setValues(e),t.handleVisibility())}))},e.prototype.handleVisibility=function(){var t=this.getRoot();"radar"==this.State.chart.type?t.showBatch("radar"):t.showBatch("axis")},e}(p),Y=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return{view:"form",padding:10,elements:[{name:"cleanRows",localId:"cleanRows",view:"checkbox",labelWidth:0,labelRight:e("Clean rows")},{view:"label",height:20,label:e("Highlight")},{cols:[{name:"minX",view:"checkbox",labelWidth:0,labelRight:e("Min X")},{name:"maxX",view:"checkbox",labelWidth:0,labelRight:e("Max X")},{name:"minY",view:"checkbox",labelWidth:0,labelRight:e("Min Y")},{name:"maxY",view:"checkbox",labelWidth:0,labelRight:e("Max Y")}]},{view:"label",height:20,label:e("Footer")},{view:"radio",name:"footer",options:[{id:1,value:e("Off")},{id:2,value:e("On")},{id:3,value:e("Sum Only")}],value:1}],on:{onChange:function(e,r,i){if("user"==i){var n=t.OutValues(t.getRoot().getValues());t.innerChange=!0,t.State.datatable=Object.assign({},n),delete t.innerChange}}}}},e.prototype.init=function(){var t=this;this.State=this.getParam("state",!0),this.on(this.State.$changes,"datatable",(function(e){t.innerChange||t.getRoot().setValues(t.InValues(e))})),this.on(this.State.$changes,"mode",(function(e){"table"==e?t.$$("cleanRows").show():t.$$("cleanRows").hide()}))},e.prototype.InValues=function(t){return(t=webix.copy(t)).footer?t.footer="sumOnly"==t.footer?3:2:t.footer=1,t},e.prototype.OutValues=function(t){switch(t.footer){case"1":delete t.footer;break;case"2":t.footer=!0;break;case"3":t.footer="sumOnly"}return t},e}(p),q=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;return this.Config=this.app.config,this.State=this.app.getState(),this.Compact=this.getParam("compact",!0),{margin:0,rows:[{type:"form",borderless:!0,padding:{left:16,right:14,top:8,bottom:4},cols:[{},{view:"button",label:e("Done"),hotkey:"esc",autowidth:!0,css:"webix_primary",click:function(){return t.ToggleForm()}}]},{borderless:!0,view:"scrollview",scroll:"y",body:{view:"accordion",css:"webix_pivot_configuration",localId:"settings",multi:!0,type:"space",padding:{left:16,right:16,top:4,bottom:16},margin:20,rows:[this.GroupConfig(e("Rows"),"pt-rows",{name:"rows",$subview:new z(this.app,"",{field:"rows",plusLabel:e("Add row")})},"table"),this.GroupConfig(e("Columns"),"pt-columns",{name:"columns",$subview:new z(this.app,"",{field:"columns",plusLabel:e("Add column")})},"table"),this.GroupConfig(e("Values"),"pt-values",{name:"values",$subview:N}),this.GroupConfig(e("Group By"),"pt-group",{name:"groupBy",$subview:W},"chart"),this.GroupConfig(e("Filters"),"pt-filter",{name:"filters",$subview:new z(this.app,"",{field:"filters",plusLabel:e("Add filter")})}),this.GroupConfig(e("Chart"),"pt-chart",{$subview:X},"chart"),this.GroupConfig(e("Table"),"wxi-columns",{$subview:Y},"table"),{}]}}]}},e.prototype.init=function(){var t=this;this.on(this.State.$changes,"readonly",(function(e,r){webix.isUndefined(r)||t.ToggleForm()}))},e.prototype.ready=function(){var t=this;this.on(this.app,"property:change",(function(e,r){t.HandleFieldChange(e,r)})),this.on(this.State.$changes,"structure",(function(){t.innerChange||t.SetValues()})),this.on(this.State.$changes,"mode",(function(e,r){var i="chart"==e;t.$$("settings").showBatch(i?"chart":"table"),r&&(i||"chart"==r)&&t.SetValues()}))},e.prototype.ToggleForm=function(){this.State.config=!this.State.config},e.prototype.SetValues=function(){var t=this,e=this.State.structure;["rows","columns","values","filters","groupBy"].forEach((function(r){var i=e[r]||t.State[r];i&&t.getSubView(r).SetValue(i)}))},e.prototype.HandleFieldChange=function(t,e){var r=webix.copy(this.State.structure);"filters"==t?e=this.CorrectFilters(r,e):this.CorrectInputs(r,t,e),r[t]=e,this.innerChange=!0,this.app.setStructure(r),delete this.innerChange},e.prototype.GroupConfig=function(t,e,r,i){return{batch:i,header:'\n\t\t\t\t<span class="webix_icon webix_pivot_config_icon '+e+'"></span>\n\t\t\t\t<span class="webix_pivot_config_label">'+t+"</span>\n\t\t\t",body:r,borderless:!0}},e.prototype.GetCorrections=function(){return{rows:["columns","values","groupBy"],columns:["rows","values"],values:["rows","columns","groupBy"],groupBy:["rows","values"]}},e.prototype.CorrectFilters=function(t,e){for(var r=function(r){var i=t.filters.find((function(t){if(t.name==e[r])return!0}));e[r]={name:e[r]},i&&!i.external&&(e[r].value=i.value)},i=0;i<e.length;i++)r(i);var n=t.filters.filter((function(t){return t.external}));return e=e.concat(n)},e.prototype.CorrectInputs=function(t,e,r){var i=this,n=this.GetCorrections()[e];n&&("string"==typeof r&&(r=[r]),r=r.map((function(t){return t.name?t.name:t})),n.forEach((function(e){var n=i.getSubView(e),o=n.GetValue();"string"==typeof o?r.find((function(t){return t==o}))&&(o=""):o=o.filter((function(t){return t.name&&(t=t.name),-1==r.indexOf(t)})),t[e]=o,n.SetValue(o)})))},e}(p),K=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.config=function(){return{view:"window",fullscreen:!0,head:!1,body:{$subview:!0}}},e}(p),J=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.config=function(){var t=this;return this.Local=this.app.getService("local"),{view:"popup",css:"webix_pivot_filter_popup",body:{view:"filter",field:"value",on:{onChange:function(e){if("user"==e){var r,i=t.app.getState(),n=webix.copy(i.structure);n.filters=n.filters.filter((function(e){var i=e.name==t.field,n=i&&!e.external;return n&&(r=e.value=t.filter.getValue()),!i||n})),i.structure=n,t.app.callEvent("filter:change",[t.field,r])}}}}}},e.prototype.Show=function(t,e){var r=this,i=this.getRoot(),n=this.filter=i.getBody();this.field=e.name;var o=n.getChildViews()[2],a=this.Local.getField(this.field),s=webix.copy(this.Local.collectFieldValues(this.field));o.clearAll(),o.parse(s),o.define({template:function(t){var e=t.value;return"date"==a.type&&(e=new Date(e)),a.predicate?r.app.config.predicates[a.predicate](e):e}}),n.define({mode:a.type}),n.config.value="",n.setValue(webix.copy(e.value||{})),i.show(t)},e}(p),Z=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.config=function(){var t=this,e=this.app.getService("locale")._;this.Compact=this.getParam("compact");var r=webix.skin.$active,i="mini"==webix.skin.$name||"compact"==webix.skin.$name,n={height:r.toolbarHeight,cols:[{view:"segmented",localId:"modes",align:"middle",inputHeight:r.inputHeight-r.inputPadding*(i?0:2),optionWidth:80,width:244,options:[{id:"table",value:e("Table")},{id:"tree",value:e("Tree")},{id:"chart",value:e("Chart")}],on:{onChange:function(e,r,i){"user"==i&&t.SetMode(e)}}},{width:r.dataPadding}]};return this.Compact&&(n.css="webix_pivot_footer",n.cols[1].width=0,n.cols.unshift({})),n},e.prototype.init=function(){var t=this;this.State=this.getParam("state"),this.on(this.State.$changes,"mode",(function(e){t.$$("modes").setValue(e)}))},e.prototype.SetMode=function(t){this.State.mode=t},e}(p),Q=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.config=function(){var t,e=this,r=this.app.getService("locale")._;if(this.Compact=this.getParam("compact"),this.State=this.getParam("state"),this.Compact)t={view:"icon",icon:"pt-settings",inputHeight:webix.skin.$active.buttonHeight,on:{onItemClick:function(){return e.ToggleConfig()}}};else{var i=r("Configure Pivot");t={view:"template",borderless:!0,width:28+webix.html.getTextSize(i,"webix_template webix_pivot_measure_size").width,template:function(){return"\n\t\t\t\t\t\t<span>"+i+'</span>\n\t\t\t\t\t\t<span class="pt-settings webix_pivot_toolbar_icon"></span>'},onClick:{webix_pivot_settings:function(){return e.ToggleConfig()}}}}t.localId="config",t.css="webix_pivot_settings",t.tooltip=r("Click to configure");var n={css:"webix_pivot_toolbar",margin:this.Compact?12:0,padding:{left:this.Compact?webix.skin.$active.inputPadding:0},height:webix.skin.$active.toolbarHeight,cols:[t,this.GetFilters()]};return this.Compact||n.cols.push(Z),n},e.prototype.init=function(){var t=this;this.filterPopup=this.ui(J),this.on(this.State.$changes,"fields",(function(e){e.length&&webix.ui(t.GetFilters(),t.$$("filters"))})),this.on(this.State.$changes,"structure",(function(e,r){r&&t.FiltersChanged(e,r)&&webix.ui(t.GetFilters(),t.$$("filters"))})),this.on(this.State.$changes,"readonly",(function(e){t.ToggleReadonly(e)}))},e.prototype.FiltersChanged=function(t,e){if(t.filters.length!=e.filters.length)return!0;for(var r=0;r<t.filters.length;r++){var i=t.filters[r],n=e.filters[r];if(i.name!=n.name||i.external!=n.external)return!0;if(JSON.stringify(i.value)!=JSON.stringify(n.value))return!0}return!1},e.prototype.ToggleConfig=function(){this.State.config=!this.State.config},e.prototype.ToggleReadonly=function(t){t?this.$$("config").hide():this.$$("config").show()},e.prototype.GetFilters=function(){var t=this,e=this.State.structure,r=[];this.State.fields.length&&e.filters.forEach((function(e){e.external||r.push(t.FilterConfig(e))}));var i=webix.skin.$active,n=(i.toolbarHeight-i.buttonHeight)/2;return{view:"scrollview",borderless:!0,scroll:"x",body:{margin:8,padding:{left:this.Compact?0:8,top:n+i.inputPadding,bottom:n+i.inputPadding},localId:"filters",cols:r}}},e.prototype.FilterConfig=function(t){var e=this,r=this.app.getService("local").getField(t.name).value;return{view:"template",borderless:!0,width:(this.Compact?0:28)+webix.html.getTextSize(r,"webix_template webix_pivot_measure_size").width,css:"webix_pivot_filter",template:function(){var i=t.value,n=i&&(i.includes||i.condition.filter)?"webix_pivot_active_filter":"",o=e.Compact?"":"<span class='pt-filter webix_pivot_toolbar_icon'></span>";return'<div class="webix_pivot_filter_inner '+n+'">\n\t\t\t\t\t<span>'+r+"</span>\n\t\t\t\t\t"+o+"\n\t\t\t\t</div>"},onClick:{webix_pivot_filter:function(){this.$scope.filterPopup.Show(this.$view,t)}}}},e}(p);webix.protoUI({name:"r-layout",sizeTrigger:function(t,e,r){this._compactValue=r,this._compactWidth=t,this._compactHandler=e,this._checkTrigger(this.$view.width,r)},_checkTrigger:function(t,e){return!this._compactWidth||!(t<=this._compactWidth&&!e||t>this._compactWidth&&e)||(this._compactWidth=null,this._compactHandler(!e),!1)},$setSize:function(t,e){if(this._checkTrigger(t,this._compactValue))return webix.ui.layout.prototype.$setSize.call(this,t,e)}},webix.ui.layout);var tt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.config=function(){var t=this.getParam("forceCompact");webix.isUndefined(t)||this.setParam("compact",t),this.Compact=this.getParam("compact");var e=[Q,{view:webix.isUndefined(t)?"r-layout":"layout",localId:"main",cols:[{$subview:!0}]}];return this.Compact?e.push(Z,{$subview:!0,name:"edit",popup:!0}):e[1].cols.push({view:"proxy",width:420,localId:"edit",css:"webix_pivot_config_container webix_shadow_medium",borderless:!0,hidden:!0,body:{$subview:!0,name:"edit"}}),{margin:0,rows:e}},e.prototype.init=function(){var t=this,e=this.getParam("state"),r=this.$$("main");r.sizeTrigger&&r.sizeTrigger(this.app.config.compactWidth,(function(e){return t.SetCompactMode(e)}),!!this.Compact),this.on(e.$changes,"mode",(function(e){t.show("./"+("chart"==e?"chart":"table"))})),this.on(e.$changes,"config",(function(e){e?t.ShowConfig():t.HideConfig()}))},e.prototype.ShowConfig=function(){this.Compact?this.show("config.popup/config",{target:"edit"}):(this.$$("edit").show(),this.show("config",{target:"edit"}))},e.prototype.HideConfig=function(){this.show("_blank",{target:"edit"}),this.Compact||this.$$("edit").hide()},e.prototype.SetCompactMode=function(t){var e=this;webix.delay((function(){e.setParam("compact",t),t||webix.fullscreen.exit(),e.refresh()}))},e}(p),et=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.config=function(){this.Config=this.app.config,this.Local=this.app.getService("local");var t=this.State=this.getParam("state",!0),e={view:"treetable",$mainView:!0,localId:"data",css:"webix_data_border webix_header_border",select:!0,leftSplit:"table"==t.mode?t.structure.rows.length:1,resizeColumn:!0,borderless:!0,columns:[],footer:t.datatable.footer};return webix.extend(e,t.datatable,!0),e},e.prototype.init=function(){var t=this;this.LoadData(),this.on(this.State.$changes,"structure",(function(e,r){r&&t.UpdateStructure()})),this.on(this.State.$changes,"datatable",(function(e,r){r&&t.refresh()})),this.on(this.State.$changes,"mode",(function(e,r){r&&"chart"!=r&&t.refresh()}))},e.prototype.LoadData=function(){var t=this;return this.Local.getData().then((function(e){t.UpdateTable(e)}))},e.prototype.UpdateStructure=function(){var t=this.Local.getPivotData();this.UpdateTable(t)},e.prototype.UpdateTable=function(t){var e=this.$$("data");e.clearAll(),"table"==this.State.mode&&(e.config.leftSplit=this.State.structure.rows.length),e.refreshColumns(this.SetColumns(t.header,t.total,t.marks)),e.parse(t.data)},e.prototype.SetColumns=function(t,e,r){for(var i=this.app.getService("locale")._,n="table"==this.State.mode?this.State.structure.rows.length:1,o=0;o<t.length;o++)if(o){o>=n?t[o].sort="int":"table"==this.State.mode&&(t[o].width=200),!t[o].format&&o>=n&&(t[o].format=this.CellFormat),r&&(t[o].cssFormat=function(t,e,i,n){var o=r[i-1],a=o?o[n-1]:null;return a?a.join(" "):""});for(var a=t[o].header,s=0;s<a.length;s++){var u=a[s];u&&(s||"total"!=u.name?s==a.length-1&&(u.text=this.HeaderTemplate(u,i)):u.text=i("Total"))}e.length&&(t[o].footer=this.CellFormat(e[o]))}else this.SetFirstColumn(t[o],i);return t},e.prototype.SetFirstColumn=function(t,e){"tree"==this.State.mode?(t.header="",t.width=300,t.template=function(t,e){return e.treetable(t,e)+t[1]}):(t.header=t.header[0].text,t.width=200),this.State.datatable.footer&&(t.footer=e("Total"))},e.prototype.HeaderTemplate=function(t,e){var r=this;if(t.operation&&t.text!=t.operation){var i=t.text.split(",");return(i=i.map((function(t){return r.Local.getField(t).value})).join(", "))+' <span class="webix_pivot_operation">'+e(t.operation)+"</span>"}return this.Local.fixMath(t.text)},e.prototype.CellFormat=function(t){return t||(t=0===t?"0":""),t?parseFloat(t).toFixed(3):t},e}(p),rt={JetView:p};rt.chart=G,rt.config=q,rt["config/popup"]=K,rt["config/properties/chart"]=X,rt["config/properties/group"]=W,rt["config/properties"]=z,rt["config/properties/table"]=Y,rt["config/properties/values"]=N,rt.filter=J,rt.main=tt,rt.mode=Z,rt.table=et,rt.toolbar=Q;var it=function(t,e){return t.key>e.key?1:-1},nt=function(t,e){return t.key<e.key?1:-1},ot=function(){function t(t,e,r,i,n){"desc"===n?this._sort=nt:"asc"===n?this._sort=it:n&&(this._sort=function(t,e){return n(t.key,e.key)}),this._label=r,this._meta=i||null,this._table=t,this._getter=e,this._prepared=0}return t.prototype.getIndexes=function(){return this._indexes},t.prototype.getValue=function(t){return this._values[t].key},t.prototype.getSize=function(){return this._values.length},t.prototype.getLabel=function(){return this._label},t.prototype.getOptions=function(){return this._prepareOptions(),this._values.map((function(t){return t.key}))},t.prototype.getMeta=function(){return this._meta},t.prototype.reset=function(){this._prepared=0},t.prototype.prepare=function(){if(!(1&this._prepared)){this._prepared=1|this._prepared,this._prepareOptions();var t=this._table,e=this._getter,r=this._keys,i=t.count();this._values.forEach((function(t,e){return t.index=e}));for(var n=this._indexes=new Array(i),o=0;o<i;o++){var a=e(o);n[o]=r.get(a).index}}},t.prototype._prepareOptions=function(){if(!(2&this._prepared)){this._prepared=2|this._prepared;for(var t=this._table,e=this._getter,r=t.count(),i=this._keys=new Map,n=this._values=[],o=0;o<r;o++){var a=e(o);void 0===i.get(a)&&i.set(a,n[n.length]={key:a,index:0})}this._sort&&n.sort(this._sort)}},t}(),at=function(){function t(t){this._pivot=t}return t.prototype.toArray=function(t){var e,r=t.cleanRows,i=t.filters,n=t.ops,o=t.total,a=t.marks,s=t.aggregateRows,u=t.aggregateColumns,l=[],c=this._pivot.getLimit().rows||0;this._pivot.filter(i),this._pivot.operations(n,[]),this._pivot.resetCursor();for(var p=0;(e=this._pivot.next())&&(l.push(e),c!==++p););var h=this._pivot.getWidth(),f=h[0],d=h[1];r&&this._cleanRows(l,f);var g={data:l,width:d+f,scaleWidth:f};return o&&(g.total=this._pivot.total(g,o)),g.allRows=this._pivot.aggregateRows(g,s)||[],g.allColumns=this._pivot.aggregateColumns(g,u)||[],a&&(g.marks=this._pivot.mark(g,a)),g},t.prototype.toNested=function(t){var e=t.filters,r=t.ops,i=t.groupOps,n=t.total,o=t.aggregateRows,a=t.aggregateColumns,s=t.marks;this._pivot.filter(e),this._pivot.operations(r,i||[]),this._pivot.resetCursor();var u=this._pivot.nested();return n&&(u.total=this._pivot.total(u,n)),u.allRows=this._pivot.aggregateRows(u,o)||[],u.allColumns=this._pivot.aggregateColumns(u,a)||[],s&&(u.marks=this._pivot.mark(u,s)),u},t.prototype.toXHeader=function(t,e){return this._pivot.getXHeader(t,e)},t.prototype._cleanRows=function(t,e){for(var r=t.length,i=new Array(e),n=0;n<r;n++)for(var o=t[n],a=0;a<e;a++){if(i[a]!==o[a]){for(var s=a;s<e;s++)i[s]=o[s];break}o[a]=""}},t}();function st(t,e){return new Function(e.propertyName,e.methodName,e.contextName,"return "+function(t,e){for(var r="",i=t.length,n=0,o=!1,a=!1,s=0;n<i;){var u=t[n];if(n++,'"'===u)o?r+=t.substr(s,n-s):s=n-1,o=!o;else{if(o)continue;var l=","===u||"/"===u||"*"===u||"+"===u||"-"===u||"("===u||")"===u,c=" "===u||"\t"===u||" \n"===u||"\r"===u;if(a){if(!l&&!c)continue;var p=t.substr(s,n-s-1);r+="("===u?e.method(p):e.property(p),a=!1}if(c)continue;l||"0"===u||"1"===u||"2"===u||"3"===u||"4"===u||"5"===u||"6"===u||"7"===u||"8"===u||"9"===u?r+=u:(a=!0,s=n-1)}}return a&&(r+=e.property(t.substr(s,n-s))),r}(t,e))}function ut(t,e,r,i){var n=function(t,e){return st(e,{propertyName:"d",methodName:"m",contextName:"c",property:function(e){var r=ct;return pt[r]=t.getColumn(e).getter,ct+=1,'c.array("'+r+'", c)'},method:function(t){return"m."+t.toLowerCase()}})}(t,r),o={table:t,order:e,from:0,to:0,array:function(t,e){for(var r=e.to-e.from,i=new Array(r),n=pt[t],o=0;o<r;o++)i[o]=n(e.order[o+e.from]);return i}};return function(t,e){return o.from=t,o.to=e,n(0,i,o)}}function lt(t,e){var r=st(t,{propertyName:"d",methodName:"m",contextName:"c",property:function(){return"d"},method:function(t){return"m."+t.toLowerCase()}});return function(t){return r(t,e,null)}}var ct=0,pt=[];var ht=function(t,e){return function(r){return t(r)&&e(r)}};function ft(t,e,r,i){var n=i.getter(t,e);if("object"!=typeof r){var o=i.compare.eq(r);return function(t){return o(n(t))}}for(var a=Object.keys(r),s=null,u=function(t){var e=i.compare[a[t].toLowerCase()](r[a[t]]),o=function(t){return e(n(t))};s=s?ht(s,o):o},l=0;l<a.length;l++)u(l);return s}function dt(t,e,r,i){var n=function(t,e,r){for(var i=Object.keys(e),n=null,o=0;o<i.length;o++){var a=i[o],s=ft(t,a,e[a],r);n=n?ht(n,s):s}return n}(e,r,i);return t.filter((function(t){return n(t)}))}var gt=function(){function t(t,e,r,i,n){this._rows=e,this._cols=r,this._dims=e.concat(r),this._table=t,this._context=n,this._cursor=-1,this._order=this._base_order=this._sort(),this._data=this._dims.map((function(t){return t.getIndexes()})),this.filter(i,!0)}return t.prototype.resetCursor=function(){this._cursor=0,this._group=this._dims.map((function(){return null})),this._order.length&&(this._rows.length&&this._nextRow(),this._cols.length&&this._nextColumn())},t.prototype.next=function(){var t=this,e=t._cursor,r=t._cols,i=t._order,n=t._group,o=t._ops,a=t._rows;if(this._cursor>=i.length)return null;for(var s=a.length,u=new Array(s+o.length*r.length),l=0;l<s;l++)u[l]=a[l].getValue(n[l]);var c=this._rows.length?this._nextRow(r.length>0):i.length;return this._fillRow(u,e,c,s),this._cursor=c,u},t.prototype.nested=function(){for(var t=this._cols,e=this._order,r=this._rows,i=r.length,o=i>0?1:0,a=[{data:[],values:[]}],s=r.map((function(){return 0})),u=[],l=[],c=[],p=this._cursor,h=0,f=this._context.limit.rows,d=Math.min(this._context.limit.columns,(t.length?this._sizes[0]*t[0].getSize():0)+o);this._cursor<e.length;){var g=new Array(d);l=c,c=[].concat(this._group);var v=this._rows.length?this._nextRow(t.length>0):e.length;if(this._fillRow(g,p,v,o),i>0){for(var m=0;m<i;m++)if(c[m]!=l[m]){for(var _=m;_<i;_++){var w=_+1,y=w===i,b=a[w]={id:y?u.length+1:0,data:y?null:[],values:y?g:[r[_].getValue(c[_])]};s[w]=p,a[_].data.push(b)}break}g[0]=r[i-1].getValue(c[i-1]),a[i].values=g}else a[0].data.push({data:null,values:g});if(u.push(g),++h>=f)break;this._cursor=p=v}return this._fillGroupRowInner(a[0],0,n([null],this._groupOps).slice(0,r.length),d),{tree:a[0].data,data:u,width:d,scaleWidth:o}},t.prototype.getLimit=function(){return this._context.limit},t.prototype.getWidth=function(){return[this._rows.length,this._cols.length&&this._ops.length?this._cols[0].getSize()*this._sizes[0]:0]},t.prototype.getXHeader=function(t,e){var r=this._cols,i=this._rows,n=this._ops,o=this._opInfo,a=e||{},s=a.nonEmpty,u=a.meta,l=t.data,c=t.tree,p=[],h=t.tree?Math.min(i.length,1):i.length,f=n.length,d=r.map((function(t){return t.getSize()})),g=d.reduce((function(t,e){return t*e}),f),v=Math.min(h+g,this._context.limit.columns),m=g,_=d.map((function(t){return m/=t})),w=[];if(this._cols.forEach((function(){return w.push(new Array(v))})),s){for(var y=0;y<h;y++)p.push(y);for(var b=h;b<v;b+=f)t:for(y=0;y<l.length;y++)if(void 0!==l[y][b]){for(var x=0;x<n.length;x++)p.push(b+x);break t}for(b=0;b<r.length;b++){var S=_[b],C=-1,$=0,V=0,k=void 0;for(y=h;y<p.length;y+=f){var P=p[y];if(P<$)V+=f;else 0!==V&&(w[b][C]={colspan:V,text:k}),C=P,$=((O=Math.floor((P-h)/S))+1)*S+h,V=f,k=r[b].getValue(O%d[b])}0!==V&&(w[b][C]={colspan:V,text:k})}}else for(y=0;y<r.length;y++){var R=d[y],O=(S=_[y],0);for(b=h;b<v;b+=S)w[y][b]=1===S?r[y].getValue(O++):{text:r[y].getValue(O++),colspan:S},O>=R&&(O=0)}if(this._ops){var L=new Array(v);for(S=n.length,b=h;b<v;b+=S)for(var A=0;A<S;A++)L[b+A]=o[A].label;w.push(L)}for(y=0;y<h;y++){var F=r.length+(this._ops?1:0);if(c){w[0][0]={text:"",rowspan:F};break}k=i[y].getLabel();w[0][y]=F>1?{text:k,rowspan:F}:k}var E={data:w};if(s&&(E.nonEmpty=p),u){var j=new Array(v);for(y=0;y<h;y++)j[y]=i[y].getMeta();for(S=n.length,b=h;b<v;b+=S)for(A=0;A<S;A++)j[b+A]=o[A].meta;E.meta=j}return E},t.prototype.filter=function(t,e){if(!t||0===Object.keys(t).length){if(e||!this._masterRules)return void(this._order=this._base_order);t=Object.assign(Object.assign({},this._masterRules),t)}e&&(this._masterRules=t),this._order=dt(this._base_order,this._table,t,this._context)},t.prototype.operations=function(t,e){var r=this._table,i=this._order,n=this._context;t=t||[],this._ops=t.map((function(t){return ut(r,i,"string"==typeof t?t:t.math,n.math)})),this._opInfo=t.map((function(t){return"string"==typeof t?{label:t,math:t}:Object.assign(Object.assign({},t),{label:t.label||t.math})})),this._groupOps=e.map((function(t){return t?t.map((function(t){return lt("string"==typeof t?t:t.math,n.math)})):null})),this._setSizes()},t.prototype.total=function(t,e){var r=this,i=e.map((function(t){return lt("string"==typeof t?t:t.math,r._context.math)}));if(t.tree){var n={data:t.tree,values:[]};return this._fillGroupRowInner(n,0,[i],t.width),n.values}return this._fillTotal(t.data,i,t.width,t.scaleWidth)},t.prototype.aggregateRows=function(t,e){var r={},i=!0;for(var n in e){var o=e[n];r[n]=lt(o,this._context.math),i=!1}return i?null:this._filAggrRows(t.data,r,t.width,t.scaleWidth)},t.prototype.aggregateColumns=function(t,e){var r={},i=!0;for(var n in e){var o=e[n];r[n]=lt(o,this._context.math),i=!1}return i?null:this._filAggrCols(t.data,r,t.width,t.scaleWidth)},t.prototype.mark=function(t,e){var r=[];for(var i in e)r.push([i,e[i]]);if(!r.length)return null;for(var n=[],o=t.width,a=t.data,s=a.length,u=0;u<s;u++){var l=[];n.push(l);for(var c=t.scaleWidth;c<o;c++){var p=a[u][c];if(void 0!==p)for(var h=0;h<r.length;h++){r[h][1](p,t.allRows[c],t.allColumns[u])&&(l[c]?l[c].push(r[h][0]):l[c]=[r[h][0]])}}}return n},t.prototype._fillGroupRowInner=function(t,e,r,i){var n=r.length>e,o=t.data;if(n)for(var a=0;a<t.data.length;a++)this._fillGroupRowInner(o[a],e+1,r,i);var s=r[e];if(s){var u=this._ops.length,l=function(e){var r=s[(e-1)%u];if(r){var i=t.data.map((function(t){return t.values[e]})).filter((function(t){return void 0!==t}));i.length>0&&(t.values[e]=r(i))}};for(a=1;a<=i;a++)l(a)}},t.prototype._fillTotal=function(t,e,r,i){var n=[];if(e)for(var o=this._ops.length,a=function(r){var i=e[(r-1)%o];if(i){var a=t.map((function(t){return t[r]})).filter((function(t){return void 0!==t}));a.length>0&&(n[r]=i(a))}},s=i;s<r;s++)a(s);return n},t.prototype._filAggrRows=function(t,e,r,i){var n=[];if(e)for(var o=function(r){var i=t.map((function(t){return t[r]})).filter((function(t){return void 0!==t}));if(i.length>0){var o=n[r]={};for(var a in e)o[a]=e[a](i)}},a=i;a<r;a++)o(a);return n},t.prototype._filAggrCols=function(t,e,r,i){var n=[];if(e)for(var o=t.length,a=0;a<o;a++){var s=(i?t[a].slice(i):t[a]).filter((function(t){return void 0!==t}));if(s.length>0){var u=n[a]={};for(var l in e)u[l]=e[l](s)}}return n},t.prototype._fillRow=function(t,e,r,i){var n=this,o=n._cols,a=n._group,s=n._ops,u=n._sizes,l=n._rows.length;if(s.length)if(o.length)for(var c=e;c<r;){for(var p=0,h=0;h<o.length;h++)p+=u[h]*a[l+h];var f=this._nextColumn();for(h=0;h<s.length;h++)t[p+i+h]=s[h](c,f);this._cursor=c=f}else for(h=0;h<s.length;h++)t[h+i]=s[h](e,r)},t.prototype._sort=function(){for(var t=this._table,e=this._dims,r=Math.min(t.count(),this._context.limit.raws),i=new Array(r),n=0;n<r;n++)i[n]=n;var o=e.length,a=e.map((function(t){return t.getIndexes()}));return i.sort((function(t,e){for(var r=0;r<o;r++){var i=a[r][t],n=a[r][e];if(i>n)return 1;if(i<n)return-1}return 0})),i},t.prototype._nextRow=function(t){for(var e=this._data,r=this._order,i=this._group,n=this._rows.length,o=!0,a=this._cursor;;){for(var s=r[a],u=0;u<n;u++)e[u][s]!=i[u]&&(t||(i[u]=e[u][s]),o=!1);if(!o)break;a++}return a},t.prototype._nextColumn=function(){for(var t=this,e=t._data,r=t._order,i=t._group,n=t._rows,o=t._cols.length+n.length,a=!0,s=this._cursor;;){for(var u=r[s],l=0;l<o;l++)e[l][u]!=i[l]&&(i[l]=e[l][u],a=!1);if(!a)break;s++}return s},t.prototype._setSizes=function(){for(var t=this._cols.map((function(t){return t.getSize()})),e=this._ops.length||1,r=t.length-1;r>=0;r--){var i=e;e*=t[r],t[r]=i}this._sizes=t},t}(),vt=function(){function t(t){this._columns=t.fields,this.parse(t.data)}return t.prototype.parse=function(t){this._raw=t,this._parse_inner()},t.prototype.prepare=function(){if(!this._prepared){this._prepared=!0;var t=this._raw,e=this._columns.filter((function(t){return 3===t.type}));if(t&&e.length)for(var r=t.length,i=e.length,n=0;n<r;n++)for(var o=0;o<i;o++){var a=e[o],s=a.getter(n);"string"==typeof s&&a.setter(n,new Date(s))}}},t.prototype._parse_inner=function(){var t=this;this._columns.forEach((function(e){var r=e.id;e.getter=function(e){return t._raw[e][r]},e.setter=function(e,i){return t._raw[e][r]=i}}))},t.prototype.getColumn=function(t){return this._columns.find((function(e){return e.id===t}))},t.prototype.count=function(){return this._raw.length},t}(),mt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.parse=function(t){this._parse_init(t.length);for(var e=t.length,r=this._columns.length,i=0;i<e;i++)for(var n=t[i],o=0;o<r;o++){var a=this._columns[o];a.data[i]=n[a.id]}},e.prototype._parse_init=function(t){this._columns.forEach((function(e){var r=e.data=new Array(t);e.getter=function(t){return r[t]},e.setter=function(t,e){return r[t]=e}}))},e.prototype.count=function(){return this._columns[0].data.length},e}(vt),_t={round:function(t){return Math.round(t)},sum:function(t){return t.reduce((function(t,e){return t+e}),0)},min:function(t){return t.reduce((function(t,e){return e<t?e:t}),t.length?t[0]:0)},max:function(t){return t.reduce((function(t,e){return e>t?e:t}),t.length?t[0]:0)},avg:function(t){return t.length?t.reduce((function(t,e){return t+e}),0)/t.length:0},wavg:function(t,e){if(!t.length)return 0;for(var r=0,i=0,n=t.length-1;n>=0;n--)r+=e[n],i+=t[n]*e[n];return i/r},count:function(t){return t.length},any:function(t){return t.length?t[0]:null}},wt={eq:function(t){return function(e){return e==t}},neq:function(t){return function(e){return e!=t}},gt:function(t){return function(e){return e>t}},gte:function(t){return function(e){return e>=t}},lt:function(t){return function(e){return e<t}},lte:function(t){return function(e){return e<=t}},in:function(t){return function(e){return t[e]}},hasPrefix:function(t){return function(e){return 0===e.indexOf(t)}},contains:function(t){return function(e){return-1!==e.indexOf(t)}}},yt={year:function(t){return t.getFullYear()},month:function(t){return t.getMonth()},day:function(t){return t.getDay()},hour:function(t){return t.getHours()},minute:function(t){return t.getMinutes()}},bt=function(){function t(t){var e=this;this._tables={},this._dimensions={},this._preds=Object.assign({},yt),this._maths=Object.assign({},_t),this._comps=Object.assign({},wt),t&&t.tables&&t.tables.forEach((function(t){return e.addTable(t)})),t&&t.dimensions&&t.dimensions.forEach((function(t){return e.addDimension(t)}))}return t.prototype.addPredicate=function(t,e){this._preds[t.toLowerCase()]=e},t.prototype.addMath=function(t,e){this._maths[t.toLowerCase()]=e},t.prototype.addComparator=function(t,e){this._comps[t.toLowerCase()]=e},t.prototype.getDimension=function(t){return this._dimensions[t]},t.prototype.addDimension=function(t){if(!this._dimensions[t.id]){var e=this._tables[t.table],r=this._predicateGetter(e,t.rule.by);this._dimensions[t.id]=new ot(e,r,t.label||t.id,t.meta||t,t.sort)}},t.prototype.resetDimensions=function(t,e){var r=this,i=this._dimensions;this._dimensions={},t&&t.forEach((function(t){var n=i[t.id];e&&n?r._dimensions[t.id]=n:r.addDimension(t)}))},t.prototype.addTable=function(t){var e="raw"===(t.driver||"raw")?vt:mt,r=this._tables[t.id]=new e(t);t.prepare&&r.prepare()},t.prototype.getTable=function(t){return this._tables[t]},t.prototype.compact=function(t,e){var r=this,i=e.rows,o=e.cols,a=e.filters,s=e.limit,u=this._tables[t],l=i?i.map((function(t){return r._dimensions[t]})):[],c=o?o.map((function(t){return r._dimensions[t]})):[];n(l,c).forEach((function(t){return t.prepare()}));var p=new gt(u,l,c,a,{getter:this._predicateGetter.bind(this),math:this._maths,compare:this._comps,limit:Object.assign({rows:1e4,columns:5e3,raws:1/0},s||{})});return new at(p)},t.prototype._predicateGetter=function(t,e){var r=e.indexOf("(");if(-1!==r){var i=this._preds[e.substr(0,r).toLowerCase()];e=e.substr(r+1,e.length-r-2);var n=t.getColumn(e).getter;return function(t){return i(n(t))}}return t.getColumn(e).getter},t}(),xt=function(){function t(t){this._app=t,this._store={},this._data=[],this._filtersHash={},this._state=t.getState(),this._initRengine()}return t.prototype._setOperations=function(){this.operations=[{id:"sum"},{id:"min"},{id:"max"},{id:"avg"},{id:"wavg"},{id:"count"},{id:"any"}];var t=this._app.config.operations;if(t)for(var e in t)this._reng.addMath(e,t[e]),this.operations.push({id:e})},t.prototype._setFilters=function(){var t=function(t){e._reng.addComparator(t,(function(e){return function(r){return"date"==t&&(r=r.valueOf()),!e||(e.includes?-1!=e.includes.indexOf(r):!e.condition.filter||webix.filters[t][e.condition.type](r,e.condition.filter))}}))},e=this;for(var r in webix.filters)t(r)},t.prototype._setPredicates=function(){var t=this._app.config.predicates;if(t)for(var e in t)this._reng.addPredicate(e,t[e])},t.prototype.getFields=function(t){var e=this._app.config.fields;if(!e)for(var r in e=[],t){var i=void 0,n=typeof t[r];switch(n){case"string":i="text";break;case"number":i=n;break;default:i="date"}e.push({id:r,value:r,type:i})}return e},t.prototype.getData=function(t){var e=this;return!Object.keys(this._store).length||t?this._app.getService("backend").data().then((function(t){return e._filtersHash={},e._table=e.getTable(t),e._reng.addTable(e._table),e._store=e.getPivotData(),e._store})):(this._store=this.getPivotData(),webix.promise.resolve(this._store))},t.prototype._initRengine=function(){this._reng=new bt,this._setFilters(),this._setOperations(),this._setPredicates()},t.prototype.getPivotData=function(){var t=this;this.setDimensions();for(var e={},r=function(t){var r,n=i._state.structure.filters[t],o=i._state.fields.find((function(t){return t.id==n.name}));e[n.name]=((r={})[o.type]=n.value,r)},i=this,n=0;n<this._state.structure.filters.length;n++)r(n);var o=this._reng.compact(this._table.id,{rows:this.getRows(),cols:this.getColumns(),limit:this.getLimits()}),a=this._state.structure.values,s=[],u=[];for(n=0;n<a.length;n++){var l=a[n].name;l=webix.isArray(l)?l.join(","):l;var c=a[n].format,p=a[n].operation,h=a[n].color,f=l?p+"("+l+")":p;s.push({math:f,label:l,meta:{operation:p,format:c,color:h}}),u.push(f)}var d=this._state.datatable,g={},v={},m={};d.minY&&(g.min="min(n)",m.webix_min_y=function(t,e){return t===e.min}),d.maxY&&(g.max="max(n)",m.webix_max_y=function(t,e){return t===e.max}),d.minX&&(v.min="min(n)",m.webix_min_x=function(t,e,r){return t===r.min}),d.maxX&&(v.max="max(n)",m.webix_max_x=function(t,e,r){return t===r.max});var _,w,y=new Array(s.length);if(d.footer)for(n=0;n<s.length;n++){p=s[n].meta.operation;"sumOnly"==d.footer&&"sum"!=p||(-1!=p.indexOf("(")?p="sum":"wavg"==p&&(p="avg"),y[n]=p+"(group)")}if("table"==this._state.mode)_=o.toArray({filters:e,ops:s,aggregateRows:g,aggregateColumns:v,marks:m,total:y,cleanRows:d.cleanRows}),w=this.getHeader(o,_),_.data=_.data.map((function(t,e){return t.unshift(e+1),t.id=e+1,t}));else{var b=[];for(n=0;n<this.getRows().length-1;n++)b.push(u);if(_=o.toNested({filters:e,ops:s,groupOps:b,aggregateRows:g,aggregateColumns:v,marks:m,total:y}),"tree"!=this._state.mode)return this.getChartData(o,_,s);w=this.getHeader(o,_),_.tree=_.tree.map((function(e){return t._toTree(e)}))}return{data:_.tree?_.tree:_.data,header:w,marks:_.marks,total:_.total}},t.prototype._toTree=function(t){var e=this,r=t.values;return r.unshift(""),t.data?(r.open=!0,r.data=t.data.map((function(t){return e._toTree(t)}))):r.id=t.id,r},t.prototype.getTable=function(t){var e=this.getFields(t[0]);return this._state.fields=e,this._data=t=this.prepareData(t,e),{id:"webixpivot"+webix.uid(),prepare:!0,driver:"raw",fields:webix.copy(e),data:t}},t.prototype.prepareData=function(t,e){return(e=e.filter((function(t){return t.prepare||"date"==t.type}))).length&&(t=t.map((function(t){return e.forEach((function(e){t[e.id]=e.prepare?e.prepare(t[e.id]):new Date(t[e.id])})),t}))),t},t.prototype.collectFieldValues=function(t){if(this._filtersHash[t])return this._filtersHash[t];for(var e=this.getField(t),r={},i=[],n=0;n<this._data.length;n++){var o=this._data[n][t];(o||0===o)&&("date"==e.type&&(o=o.valueOf()),r[o]||(r[o]=!0,i.push({value:o,id:o})))}return this._filtersHash[t]=i,i},t.prototype.fixMath=function(t){var e=this._app.getService("locale")._,r=this._state.fields,i=new RegExp(r.map((function(t){return"\\b"+t.id+"\\b(?!\\()"})).join("|"),"g"),n=this.operations,o=new RegExp(n.map((function(t){return"\\b"+t.id+"\\b\\("})).join("|"),"g");return t.replaceAll(i,(function(t){return r.find((function(e){return e.id==t})).value})).replaceAll(o,(function(t){return e(t.substring(0,t.length-1))+"("}))},t.prototype.getField=function(t){return this._state.fields.find((function(e){return e.id==t}))},t.prototype.getColumns=function(){var t=this._state.structure;return"chart"==this._state.mode&&t.groupBy?[t.groupBy]:t.columns},t.prototype.getRows=function(){return"chart"!=this._state.mode?this._state.structure.rows:[]},t.prototype.getLimits=function(){return{}},t.prototype.getHeader=function(t,e){var r=t.toXHeader(e,{meta:!0,nonEmpty:!0}),i=r.data,n=[];return r.nonEmpty.forEach((function(t){n.push({id:t+1,header:i.map((function(e){e=e[t]&&e[t].text?e[t]:{text:e[t]||""};var i=r.meta[t]&&r.meta[t].operation;return i&&(e.operation=i),e})),format:r.meta[t]&&r.meta[t].format})})),n},t.prototype.setDimensions=function(){this._reng.resetDimensions();for(var t=this.getColumns().concat(this.getRows()||[]),e=0;e<t.length;e++){var r=this.getField(t[e]);this._reng.addDimension({id:t[e],table:this._table.id,label:t[e],rule:{by:r.predicate?r.predicate+"("+t[e]+")":t[e]}})}},t.prototype.getChartData=function(t,e,r){var i=[],n=[],o=t.toXHeader(e).data[0];if(e.data.length)for(var a=webix.copy(e.data[0]),s=0;a.length;){var u=a.splice(0,r.length);if(!u.length)break;u.push(o[s].text||o[s]),i.push(u),s+=r.length}for(var l=0;l<r.length;l++)n.push({text:r[l].label||r[l].meta.operation,operation:r[l].meta.operation,color:r[l].meta.color});return{data:i,values:n}},t.prototype.getPalette=function(){return[["#e33fc7","#a244ea","#476cee","#36abee","#58dccd","#a7ee70"],["#d3ee36","#eed236","#ee9336","#ee4339","#595959","#b85981"],["#c670b8","#9984ce","#b9b9e2","#b0cdfa","#a0e4eb","#7faf1b"],["#b4d9a4","#f2f79a","#ffaa7d","#d6806f","#939393","#d9b0d1"],["#780e3b","#684da9","#242464","#205793","#5199a4","#065c27"],["#54b15a","#ecf125","#c65000","#990001","#363636","#800f3e"]]},t.prototype.getValueColor=function(t){var e=this.getPalette(),r=t/e[0].length;r=r>e.length?0:parseInt(r,10);var i=t%e[0].length;return e[r][i]},t}(),St=function(){function t(t,e){this.app=t,this._url=e}return t.prototype.url=function(t){return this._url+(t||"")},t.prototype.data=function(){return webix.ajax(this.url()).then((function(t){return t.json()}))},t}(),Ct=function(t){function e(e){var r=this,n=e.mode||"tree",o=e.structure||{},a=e.chart||{};webix.extend(a,{type:"bar",scale:"linear",lines:!0}),delete a.id;var s=e.datatable||{};delete s.id;var u=U({mode:n,structure:o,readonly:e.readonly||!1,fields:e.fields||[],datatable:s,chart:a,config:!1}),l={router:y,version:"9.0.0",debug:!0,compactWidth:720,start:"main/"+("chart"==n?"chart":"table"),params:{state:u,forceCompact:e.compact}};return(r=t.call(this,i(i({},l),e))||this).setService("backend",new(r.dynamic(St))(r,r.config.url)),r.setService("local",new(r.dynamic(xt))(r,e)),o=r.prepareStructure(o,!0),r.use(I,r.config.locale||{lang:"en",webix:{en:"en-US"}}),r}return r(e,t),e.prototype.dynamic=function(t){return this.config.override&&this.config.override.get(t)||t},e.prototype.require=function(t,e){return"jet-views"===t?rt[e]:"jet-locales"===t?Vt[e]:null},e.prototype.getState=function(){return this.config.params.state},e.prototype.setStructure=function(t){this.getState().structure=this.prepareStructure(t)},e.prototype.getStructure=function(){return this.getState().structure},e.prototype.prepareStructure=function(t,e){var r=this.getState().mode;webix.extend(t,{rows:[],columns:[],values:[],filters:[]}),e?"chart"==r&&t.groupBy||!t.columns.length?t.groupBy&&(t.columns=[t.groupBy]):t.groupBy=t.columns[0]:"chart"!=r?t.groupBy=t.columns[0]:t.groupBy?t.columns[0]!==t.groupBy&&(t.columns=[t.groupBy]):t.columns=[];for(var n=[],o=0;o<t.values.length;o++){var a=t.values[o];if(webix.isArray(a.operation)){a.color=(webix.isArray(a.color)?a.color:[a.color])||[];for(var s=0;s<a.operation.length;s++){var u=i({},a);u.operation=a.operation[s],u.color=a.color&&a.color[s],n.push(u)}}else n.push(a)}for(o=0;o<n.length;o++)n[o].color||(n[o].color=this.getService("local").getValueColor(o));return t.values=n,t},e}(w);webix.protoUI({name:"pivot",app:Ct,defaults:{borderless:!1},$init:function(){var t=this;this.name="pivot";var e=this.$app.getState();for(var r in e)H(e,this.config,r);this.$app.attachEvent("filter:change",(function(e,r){return t.callEvent("onFilterChange",[e,r])}))},$exportView:function(t){var e=this.$app.getRoot().queryView({$mainView:!0});return e.$exportView?e.$exportView(t):e},getState:function(){return this.$app.getState()},getService:function(t){return this.$app.getService(t)},setStructure:function(t){this.$app.setStructure(t)},getStructure:function(){return this.$app.getStructure()}},webix.ui.jetapp);var $t={Backend:St,LocalData:xt},Vt={en:{Done:"Done",Table:"Table",Tree:"Tree",Chart:"Chart","Click to configure":"Click to configure","Configure Pivot":"Configure Pivot",Total:"Total",Columns:"Columns","Add column":"Add column",Rows:"Rows","Add row":"Add row","Clean rows":"Clean rows",Filters:"Filters","Add filter":"Add filter","Group By":"Group By","Chart type":"Chart type","Logarithmic scale":"Logarithmic scale","X axis title":"X axis title","Y axis title":"Y axis title","Scale color":"Scale color","Circled lines":"Circled lines",Lines:"Lines",Line:"Line",Radar:"Radar",Bar:"Bar",Area:"Area",Spline:"Spline","Spline Area":"Spline Area",Values:"Values","Add value":"Add value","Field not defined":"Field not defined",Highlight:"Highlight","Min X":"Min X","Max X":"Max X","Min Y":"Min Y","Max Y":"Max Y",Footer:"Footer",Off:"Off",On:"On","Sum Only":"Sum Only",count:"count",max:"max",min:"min",avg:"avg",wavg:"wavg",any:"any",sum:"sum"}};t.App=Ct,t.locales=Vt,t.services=$t,t.views=rt,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=pivot.min.js.map
